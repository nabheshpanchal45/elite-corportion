<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Elite Corporation - Billing App</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    /* ---------- Global ---------- */
    :root{
      --bg:#fafbfc;
      --card:#fff;
      --accent:#faad23;
      --accent-dark:#f79a16;
      --text:#28375e;
      --muted:#888;
      --table-head:#ffe3a3;
      --table-border:#e6eaf0;
    }
    *{box-sizing:border-box}
    body{font-family:'Roboto',Arial,sans-serif;background:var(--bg);margin:0;padding:0;color:var(--text);-webkit-font-smoothing:antialiased}
    .centerize{max-width:960px;margin:20px auto;padding:18px}

    /* ---------- Card / Container ---------- */
    .card{
      max-width:720px;margin:20px auto;background:var(--card);border-radius:10px;border:1px solid #e5e9f1;
      box-shadow:0 4px 20px rgba(0,0,0,0.07);padding:26px;
    }
    #logo{width:92px;display:block;margin:0 auto 8px auto}
    h1,h2,h3{margin:0 0 12px 0;text-align:center;color:var(--text)}
    label{display:block;margin-top:12px;font-weight:500;color:var(--text)}
    input[type="text"], input[type="number"], select, input[type="date"]{
      width:100%;padding:9px 12px;margin-top:6px;border:1px solid #cfd8dc;border-radius:6px;font-size:1rem;
    }
    button{
      background:var(--accent);color:var(--text);border:none;padding:10px 22px;border-radius:8px;font-weight:700;cursor:pointer;
      box-shadow:0 2px 12px rgba(250,173,35,0.08);
    }
    button:hover{background:var(--accent-dark)}
    .big-row{display:flex;gap:16px;align-items:center}
    .big-row .col{flex:1}

    /* ---------- Pages (SPA) ---------- */
    .page{display:none}
    .page.active{display:block}

    /* ---------- Main menu buttons ---------- */
    .menu-row{display:flex;gap:14px;justify-content:space-between;margin-top:18px}
    .menu-btn{flex:1;padding:18px;border-radius:10px;font-size:1.05rem;font-weight:700;display:flex;align-items:center;justify-content:center}
    .menu-btn.left{margin-right:8px}
    .menu-btn.center{margin:0 8px}
    .menu-btn.right{margin-left:8px}
    .menu-btn:hover{opacity:0.95}

    /* ---------- Rate table ---------- */
    .rates-table{width:100%;border-collapse:collapse;margin-top:16px;background:#f6f9fb}
    .rates-table th,.rates-table td{border:1px solid var(--table-border);padding:8px;text-align:left}
    .rates-table th{background:var(--table-head);color:var(--text)}

    /* ---------- Dashboard table ---------- */
    .table-wrap{overflow-x:auto;margin-top:10px}
    .dashboard-table{min-width:760px;width:100%;border-collapse:collapse;background:#f6f9fb}
    .dashboard-table th,.dashboard-table td{border:1px solid var(--table-border);padding:8px;text-align:left}
    .dashboard-table th{background:var(--table-head);color:var(--text)}
    .action-btn{background:var(--accent);color:var(--text);padding:8px 12px;border-radius:8px;font-weight:700;cursor:pointer}
    .search-row{display:flex;gap:10px;align-items:center;margin-bottom:8px}
    .search-row input{flex:1}

    /* ---------- form layout ---------- */
    .row{display:flex;gap:12px}
    .row .flex1{flex:1}

    /* ---------- small helper ---------- */
    .muted{color:var(--muted);font-size:0.95rem}
    .footer{margin-top:22px;text-align:center;color:var(--muted);font-size:0.95rem}

    /* ---------- print rules: hide interactive elements ---------- */
    @media print{
      button, .no-print, .menu-row, .search-row, .action-btn { display: none !important; }
      body{background:#fff}
      .card{box-shadow:none;border:none}
    }

    /* ---------- responsive tweaks ---------- */
    @media (max-width:720px){
      .menu-row{flex-direction:column}
      .menu-btn{padding:14px}
      .big-row{flex-direction:column}
    }
  </style>
</head>
<body>
  <div class="card" id="appCard">
<img src="C:\Users\Nabhesh\OneDrive\Desktop\Elite Corporation\elite-fb-img.jpg"width="670" height="300">  
    <h1>Elite Corporation Pest Control</h1>

    <!-- ===== Login Page ===== -->
    <div id="page-login" class="page active">
      <h2>Admin Login</h2>
      <p class="muted" style="text-align:center">Enter admin password to continue</p>
      <label>Password</label>
      <input id="loginPass" type="password" placeholder="Enter password" />
      <div style="text-align:center;margin-top:14px">
        <button onclick="doLogin()">Login</button>
      </div>
      <p id="loginMsg" class="muted" style="text-align:center;margin-top:10px"></p>
    </div>

    <!-- ===== Main Menu ===== -->
    <div id="page-menu" class="page">
      <h2>Main Menu</h2>
      <div class="menu-row">
        <button class="menu-btn left" onclick="showPage('page-quotation')" style="background:#f7f1e0">Quotation</button>
        <button class="menu-btn center" onclick="showPage('page-dashboard')" style="background:#eaf4ff">Dashboard</button>
        <button class="menu-btn right" onclick="showPage('page-billing')" style="background:#fff0d9">eChallan / Billing</button>
      </div>

      <!-- Rates Chart (bottom of menu) -->
      <h3 style="margin-top:18px">Price Chart</h3>
      <table class="rates-table">
        <tr><th>Service</th><th>Rate (₹/m²)</th></tr>
        <tr><td>Bed Bugs</td><td>₹15</td></tr>
        <tr><td>Cockroach</td><td>₹10</td></tr>
        <tr><td>Ant</td><td>₹8</td></tr>
        <tr><td>Termites</td><td>₹20</td></tr>
        <tr><td>Mosquito and fly </td><td>₹25</td></tr>
        <tr><td>Rodant control </td><td>₹12</td></tr>
      </table>

      <div style="text-align:center;margin-top:14px">
        <button class="no-print" onclick="logout()">Logout</button>
      </div>
    </div>

    <!-- ===== Dashboard Page ===== -->
    <div id="page-dashboard" class="page">
      <h2>Billing & Quotation History</h2>
      <div class="search-row no-print">
        <input id="searchBox" type="text" placeholder="Search by invoice, customer, service, mode..." oninput="renderDashboard()" />
        <select id="filterMode" onchange="renderDashboard()">
          <option value="">All</option>
          <option value="Quotation">Quotation</option>
          <option value="eChallan">eChallan</option>
        </select>
        <button class="no-print" onclick="clearStorage()">Clear All</button>
      </div>

      <div class="table-wrap">
        <table class="dashboard-table" id="dashboardTable">
          <thead>
            <tr>
              <th>Invoice No</th>
              <th>Date</th>
              <th>Customer</th>
              <th>Service(s)</th>
              <th>Area</th>
              <th>Total (₹)</th>
              <th>Mode</th>
              <th class="no-print">Action</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div style="text-align:center;margin-top:12px">
        <button class="no-print" onclick="showPage('page-menu')">Back to Menu</button>
      </div>
    </div>

    <!-- ===== Quotation Page ===== -->
    <div id="page-quotation" class="page">
      <h2>Create Quotation</h2>

      <label>Area (m²)</label>
      <input id="q_area" type="number" min="1" value="100" />

      <label>Service 1 (mandatory)</label>
      <select id="q_service1">
        <option value="">-- Select service --</option>
        <option>Bed Bugs</option><option>Cockroach</option><option>Ant</option><option>Termites</option><option>Containers</option><option>Contracts</option>
      </select>

      <label>Service 2 (optional)</label>
      <select id="q_service2">
        <option value="">-- None --</option>
        <option>Bed Bugs</option><option>Cockroach</option><option>Ant</option><option>Termites</option><option>Containers</option><option>Contracts</option>
      </select>

      <label>Service 3 (optional)</label>
      <select id="q_service3">
        <option value="">-- None --</option>
        <option>Bed Bugs</option><option>Cockroach</option><option>Ant</option><option>Termites</option><option>Containers</option><option>Contracts</option>
      </select>

      <label>Country Code</label>
      <select id="q_countryCode">
        <option value="91">India (+91)</option><option value="971">UAE (+971)</option><option value="1">USA (+1)</option>
        <option value="44">UK (+44)</option><option value="61">Australia (+61)</option><option value="65">Singapore (+65)</option>
      </select>

      <label>WhatsApp Number (without country code)</label>
      <input id="q_whatsapp" type="text" placeholder="e.g. 9876543210" />

      <!-- summary & taxes -->
      <div style="margin-top:12px">
        <p class="muted">Taxes: GST 18% & Service Tax 2% (applies on basic total)</p>
        <p><strong>Basic Total: </strong> ₹<span id="q_basic">0.00</span></p>
        <p><strong>GST (18%): </strong> ₹<span id="q_gst">0.00</span></p>
        <p><strong>Service Tax (2%): </strong> ₹<span id="q_st">0.00</span></p>
        <p class="muted"><strong>Final Amount: </strong> ₹<span id="q_final">0.00</span></p>
      </div>

      <div class="big-row" style="margin-top:12px">
        <div class="col" style="text-align:left">
          <button onclick="calcQuotation()">Calculate</button>
        </div>
        <div class="col" style="text-align:right">
          <button class="no-print" onclick="sendQuotation()">Send WhatsApp</button>
          <button class="no-print" onclick="printQuotation()">Print / PDF</button>
        </div>
      </div>

      <div style="text-align:center;margin-top:12px">
        <button class="no-print" onclick="showPage('page-menu')">Back to Menu</button>
      </div>
    </div>

    <!-- ===== Billing Page ===== -->
    <div id="page-billing" class="page">
      <h2>Create eChallan / Billing</h2>

      <label>Area (m²)</label>
      <input id="b_area" type="number" min="1" value="100" />

      <label>Service 1 (mandatory)</label>
      <select id="b_service1">
        <option value="">-- Select service --</option>
        <option>Bed Bugs</option><option>Cockroach</option><option>Ant</option><option>Termites</option><option>Containers</option><option>Contracts</option>
      </select>

      <label>Service 2 (optional)</label>
      <select id="b_service2">
        <option value="">-- None --</option>
        <option>Bed Bugs</option><option>Cockroach</option><option>Ant</option><option>Termites</option><option>Containers</option><option>Contracts</option>
      </select>

      <label>Service 3 (optional)</label>
      <select id="b_service3">
        <option value="">-- None --</option>
        <option>Bed Bugs</option><option>Cockroach</option><option>Ant</option><option>Termites</option><option>Containers</option><option>Contracts</option>
      </select>

      <label>Date</label>
      <input id="b_date" type="date" value="" />

      <label>Customer Name</label>
      <input id="b_customer" type="text" />

      <label>Address</label>
      <input id="b_address" type="text" />

      <label>Country Code</label>
      <select id="b_countryCode">
        <option value="91">India (+91)</option><option value="971">UAE (+971)</option><option value="1">USA (+1)</option>
        <option value="44">UK (+44)</option><option value="61">Australia (+61)</option><option value="65">Singapore (+65)</option>
      </select>

      <label>WhatsApp Number (without country code)</label>
      <input id="b_whatsapp" type="text" placeholder="e.g. 9876543210" />

      <!-- summary & taxes -->
      <div style="margin-top:12px">
        <p class="muted">Taxes: GST 18% & Service Tax 2% (applies on basic total)</p>
        <p><strong>Basic Total: </strong> ₹<span id="b_basic">0.00</span></p>
        <p><strong>GST (18%): </strong> ₹<span id="b_gst">0.00</span></p>
        <p><strong>Service Tax (2%): </strong> ₹<span id="b_st">0.00</span></p>
        <p class="muted"><strong>Final Amount: </strong> ₹<span id="b_final">0.00</span></p>
      </div>

      <div class="big-row" style="margin-top:12px">
        <div class="col" style="text-align:left">
          <button onclick="calcBilling()">Calculate</button>
        </div>
        <div class="col" style="text-align:right">
          <button class="no-print" onclick="sendBilling()">Send WhatsApp</button>
          <button class="no-print" onclick="printBilling()">Print / PDF</button>
        </div>
      </div>

      <div style="text-align:center;margin-top:12px">
        <button class="no-print" onclick="showPage('page-menu')">Back to Menu</button>
      </div>
    </div>

    <div class="footer">© 1962 Elite Corporation | Designed by <strong>Nabhesh Panchal </strong></div>
  </div>

  <script>
    /* ---------- constants and storage ---------- */
    const RATES = {"Bed Bugs":15,"Cockroach":10,"Ant":8,"Termites":20,"Mosquito and fly":25,"Rodent control":12};
    const GST = 0.18;
    const SERVICE_TAX = 0.02;

    // load or init invoice counter and records
    let invoiceCounter = localStorage.getItem('invoiceCounter') ? parseInt(localStorage.getItem('invoiceCounter')) : 1000;
    let RECORDS = localStorage.getItem('ec_records') ? JSON.parse(localStorage.getItem('ec_records')) : [];

    // show initial dashboard if any records
    window.addEventListener('load', ()=>{
      // set default date for billing to today
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('b_date').value = today;
      renderDashboard();
    });

    /* ---------- SPA navigation ---------- */
    function showPage(id){
      document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      // clear messages
      const loginMsg = document.getElementById('loginMsg'); if(loginMsg) loginMsg.textContent = '';
      // if dashboard shown, render
      if(id==='page-dashboard') renderDashboard();
    }

    /* ---------- Login ---------- */
    function doLogin(){
      const val = document.getElementById('loginPass').value;
      const msg = document.getElementById('loginMsg');
      if(val === 'elite@1969'){
        // clear pass
        document.getElementById('loginPass').value = '';
        showPage('page-menu');
      } else {
        msg.textContent = 'Incorrect password';
      }
    }
    function logout(){ showPage('page-login'); }

    /* ---------- Utility: save records ---------- */
    function saveRecords(){
      localStorage.setItem('ec_records', JSON.stringify(RECORDS));
      localStorage.setItem('invoiceCounter', invoiceCounter.toString());
    }

    /* ---------- Dashboard rendering & search ---------- */
    function renderDashboard(){
      const tbody = document.querySelector('#dashboardTable tbody');
      tbody.innerHTML = '';
      const q = (document.getElementById('searchBox')?.value || '').toLowerCase();
      const modeFilter = document.getElementById('filterMode')?.value || '';

      const toShow = RECORDS.filter(r=>{
        if(modeFilter && r.mode !== modeFilter) return false;
        if(!q) return true;
        // search invoice, customer, services, mode
        return (r.invoiceNo.toLowerCase().includes(q) ||
                (r.customer || '').toLowerCase().includes(q) ||
                (r.services || '').toLowerCase().includes(q) ||
                (r.mode || '').toLowerCase().includes(q));
      });

      if(toShow.length === 0){
        const tr = document.createElement('tr');
        tr.innerHTML = `<td colspan="8" style="text-align:center;padding:12px;color:var(--muted)">No records found</td>`;
        tbody.appendChild(tr);
        return;
      }

      toShow.forEach(r=>{
        const tr = document.createElement('tr');
        const actions = `<button class="action-btn no-print" onclick="reprintRecord('${r.invoiceNo}')">Reprint</button>`;
        tr.innerHTML = `<td>${r.invoiceNo}</td>
                        <td>${r.date}</td>
                        <td>${r.customer || '-'}</td>
                        <td>${r.services}</td>
                        <td>${r.area}</td>
                        <td>${Number(r.total).toFixed(2)}</td>
                        <td>${r.mode}</td>
                        <td class="no-print">${actions}</td>`;
        tbody.appendChild(tr);
      });
    }

    function clearStorage(){
      if(!confirm('Clear all records from browser storage?')) return;
      RECORDS = [];
      invoiceCounter = 1000;
      saveRecords();
      renderDashboard();
      alert('Cleared.');
    }

    /* ---------- QUOTATION: Calculation, send, print ---------- */
    function calcQuotation(){
      const area = Number(document.getElementById('q_area').value) || 0;
      const s1 = document.getElementById('q_service1').value;
      const s2 = document.getElementById('q_service2').value;
      const s3 = document.getElementById('q_service3').value;
      if(!s1){ alert('Service 1 is mandatory'); return; }

      // compute basic total: sum of (area * rate) for each selected service
      let basic = 0;
      [s1,s2,s3].forEach(s=>{
        if(s && RATES[s]) basic += area * RATES[s];
      });
      const gstAmt = basic * GST;
      const stAmt = basic * SERVICE_TAX;
      const finalAmt = basic + gstAmt + stAmt;

      document.getElementById('q_basic').textContent = basic.toFixed(2);
      document.getElementById('q_gst').textContent = gstAmt.toFixed(2);
      document.getElementById('q_st').textContent = stAmt.toFixed(2);
      document.getElementById('q_final').textContent = finalAmt.toFixed(2);

      return {basic, gstAmt, stAmt, finalAmt, services: [s1,s2,s3].filter(Boolean).join(', '), area};
    }

    function sendQuotation(){
      const calc = calcQuotation();
      if(!calc) return;
      const country = document.getElementById('q_countryCode').value;
      const whats = (document.getElementById('q_whatsapp').value || '').trim();
      if(!/^[0-9]{7,12}$/.test(whats)){ alert('Enter valid WhatsApp number (7-12 digits)'); return; }
      // create record & store
      invoiceCounter++; saveRecords(); // keep counter persisted
      const inv = 'EC-' + invoiceCounter;
      const date = new Date().toLocaleDateString();
      const rec = { invoiceNo: inv, date, customer: '', services: calc.services, area: calc.area, total: calc.finalAmt.toFixed(2), mode: 'Quotation', whatsapp: country + whats };
      RECORDS.push(rec); saveRecords();
      renderDashboard();

      // send text-only quote
      const text = `Quotation - Elite Corporation\nInvoice: ${inv}\nServices: ${rec.services}\nArea: ${rec.area} m²\nTotal: ₹${rec.total}\n(Quotation only)\nThank you!`;
      window.open('https://wa.me/' + rec.whatsapp + '?text=' + encodeURIComponent(text), '_blank');
      alert('Quotation sent (WhatsApp text). Invoice saved to dashboard.');
    }

    function printQuotation(){
      const calc = calcQuotation();
      if(!calc) return;
      invoiceCounter++; // increment for quotation print
      const inv = 'EC-' + invoiceCounter;
      const date = new Date().toLocaleDateString();
      const services = calc.services;
      const basic = calc.basic, gstAmt = calc.gstAmt, stAmt = calc.stAmt, finalAmt = calc.finalAmt;
      // store record
      const rec = { invoiceNo: inv, date, customer: '', services, area: calc.area, total: finalAmt.toFixed(2), mode: 'Quotation', whatsapp: '' };
      RECORDS.push(rec); saveRecords(); renderDashboard();

      // build printable HTML - NO interactive buttons included, so print view is clean
      const invoiceHtml = `
        <html><head><title>Quotation ${inv}</title>
        <style>body{font-family:Roboto,Arial,sans-serif;padding:24px} h2{color:${getComputedStyle(document.documentElement).getPropertyValue('--text')} } p{margin:6px 0}</style>
        </head><body>
        <img src="55787.jpg" style="width:90px;display:block;margin-bottom:10px">
        <h2>Elite Corporation - Quotation</h2>
        <p><strong>Reg. No:</strong> EC-MH-2023</p>
        <p><strong>Invoice No:</strong> ${inv}</p>
        <p><strong>Date:</strong> ${date}</p><hr>
        <p><strong>Services:</strong> ${services}</p>
        <p><strong>Area:</strong> ${calc.area} m²</p>
        <p><strong>Basic:</strong> ₹${basic.toFixed(2)}</p>
        <p><strong>GST (18%):</strong> ₹${gstAmt.toFixed(2)}</p>
        <p><strong>Service Tax (2%):</strong> ₹${stAmt.toFixed(2)}</p>
        <p style="font-weight:700;margin-top:10px">Final Total: ₹${finalAmt.toFixed(2)}</p>
        <hr><p>Thank you for choosing Elite Corporation!</p>
        </body></html>
      `;
      const w = window.open();
      w.document.write(invoiceHtml); w.document.close();
      w.print();
      alert('Quotation printed and saved to dashboard.');
    }

    /* ---------- BILLING: Calculation, send, print ---------- */
    function calcBilling(){
      const area = Number(document.getElementById('b_area').value) || 0;
      const s1 = document.getElementById('b_service1').value;
      const s2 = document.getElementById('b_service2').value;
      const s3 = document.getElementById('b_service3').value;
      if(!s1){ alert('Service 1 is mandatory'); return; }

      let basic = 0;
      [s1,s2,s3].forEach(s=>{
        if(s && RATES[s]) basic += area * RATES[s];
      });
      const gstAmt = basic * GST;
      const stAmt = basic * SERVICE_TAX;
      const finalAmt = basic + gstAmt + stAmt;

      document.getElementById('b_basic').textContent = basic.toFixed(2);
      document.getElementById('b_gst').textContent = gstAmt.toFixed(2);
      document.getElementById('b_st').textContent = stAmt.toFixed(2);
      document.getElementById('b_final').textContent = finalAmt.toFixed(2);

      return {basic, gstAmt, stAmt, finalAmt, services: [s1,s2,s3].filter(Boolean).join(', '), area};
    }

    function sendBilling(){
      const calc = calcBilling();
      if(!calc) return;
      const country = document.getElementById('b_countryCode').value;
      const whats = (document.getElementById('b_whatsapp').value || '').trim();
      const cust = document.getElementById('b_customer').value || '';
      const addr = document.getElementById('b_address').value || '';
      const dateVal = document.getElementById('b_date').value || new Date().toLocaleDateString();
      if(!/^[0-9]{7,12}$/.test(whats)){ alert('Enter valid WhatsApp number (7-12 digits)'); return; }

      // increment & store
      invoiceCounter++;
      const inv = 'EC-' + invoiceCounter;
      const rec = { invoiceNo: inv, date: dateVal, customer: cust, services: calc.services, area: calc.area, total: calc.finalAmt.toFixed(2), mode: 'eChallan', whatsapp: country + whats, address: addr };
      RECORDS.push(rec); saveRecords(); renderDashboard();

      // send text + open printable view for PDF if needed -> eChallan should allow both
      const text = `eChallan - Elite Corporation\nInvoice: ${inv}\nCustomer: ${cust}\nAddress: ${addr}\nServices: ${rec.services}\nArea: ${rec.area} m²\nTotal: ₹${rec.total}\nThank you!`;
      // open whatsapp text
      window.open('https://wa.me/' + rec.whatsapp + '?text=' + encodeURIComponent(text), '_blank');

      // open printable eChallan in new window (no buttons)
      const invoiceHtml = `
        <html><head><title>eChallan ${inv}</title>
        <style>body{font-family:Roboto,Arial,sans-serif;padding:24px} p{margin:6px 0}</style>
        </head><body>
        <img src="55787.jpg" style="width:90px;display:block;margin-bottom:10px">
        <h2>Elite Corporation - eChallan</h2>
        <p><strong>Reg. No:</strong> EC-MH-2023</p>
        <p><strong>Invoice No:</strong> ${inv}</p>
        <p><strong>Date:</strong> ${dateVal}</p><hr>
        <p><strong>Customer:</strong> ${cust}</p>
        <p><strong>Address:</strong> ${addr}</p>
        <p><strong>Services:</strong> ${rec.services}</p>
        <p><strong>Area:</strong> ${rec.area} m²</p>
        <p><strong>Basic:</strong> ₹${calc.basic.toFixed(2)}</p>
        <p><strong>GST (18%):</strong> ₹${calc.gstAmt.toFixed(2)}</p>
        <p><strong>Service Tax (2%):</strong> ₹${calc.stAmt.toFixed(2)}</p>
        <p style="font-weight:700;margin-top:10px">Final Total: ₹${calc.finalAmt.toFixed(2)}</p>
        <hr><p>Thank you for choosing Elite Corporation!</p>
        </body></html>
      `;
      const w = window.open();
      w.document.write(invoiceHtml); w.document.close();
      w.print();
      alert('eChallan printed and WhatsApp text sent. Record saved.');
    }

    function printBilling(){
      const calc = calcBilling();
      if(!calc) return;
      const cust = document.getElementById('b_customer').value || '';
      const addr = document.getElementById('b_address').value || '';
      const dateVal = document.getElementById('b_date').value || new Date().toLocaleDateString();

      invoiceCounter++;
      const inv = 'EC-' + invoiceCounter;
      const rec = { invoiceNo: inv, date: dateVal, customer: cust, services: calc.services, area: calc.area, total: calc.finalAmt.toFixed(2), mode: 'eChallan', whatsapp: '', address: addr };
      RECORDS.push(rec); saveRecords(); renderDashboard();

      const invoiceHtml = `
        <html><head><title>eChallan ${inv}</title>
        <style>body{font-family:Roboto,Arial,sans-serif;padding:24px} p{margin:6px 0}</style>
        </head><body>
        <img src="55787.jpg" style="width:90px;display:block;margin-bottom:10px">
        <h2>Elite Corporation - eChallan</h2>
        <p><strong>Reg. No:</strong> EC-MH-2023</p>
        <p><strong>Invoice No:</strong> ${inv}</p>
        <p><strong>Date:</strong> ${dateVal}</p><hr>
        <p><strong>Customer:</strong> ${cust}</p>
        <p><strong>Address:</strong> ${addr}</p>
        <p><strong>Services:</strong> ${rec.services}</p>
        <p><strong>Area:</strong> ${rec.area} m²</p>
        <p><strong>Basic:</strong> ₹${calc.basic.toFixed(2)}</p>
        <p><strong>GST (18%):</strong> ₹${calc.gstAmt.toFixed(2)}</p>
        <p><strong>Service Tax (2%):</strong> ₹${calc.stAmt.toFixed(2)}</p>
        <p style="font-weight:700;margin-top:10px">Final Total: ₹${calc.finalAmt.toFixed(2)}</p>
        <hr><p>Thank you for choosing Elite Corporation!</p>
        </body></html>
      `;
      const w = window.open();
      w.document.write(invoiceHtml); w.document.close();
      w.print();
      alert('Printed and saved to dashboard.');
    }

    /* ---------- Reprint a saved record (open print view) ---------- */
    function reprintRecord(invoiceNo){
      const rec = RECORDS.find(r=>r.invoiceNo === invoiceNo);
      if(!rec) return alert('Record not found');
      // reconstruct values
      const rateSum = rec.services.split(',').reduce((acc,s)=>{
        s=s.trim(); if(RATES[s]) acc += rec.area * RATES[s]; return acc;
      },0);
      const gstAmt = rateSum * GST;
      const stAmt = rateSum * SERVICE_TAX;
      const finalAmt = Number(rec.total);

      const invoiceHtml = `
        <html><head><title>${rec.mode} ${rec.invoiceNo}</title>
        <style>body{font-family:Roboto,Arial,sans-serif;padding:24px} p{margin:6px 0}</style>
        </head><body>
        <img src="55787.jpg" style="width:90px;display:block;margin-bottom:10px">
        <h2>Elite Corporation - ${rec.mode}</h2>
        <p><strong>Reg. No:</strong> EC-MH-2023</p>
        <p><strong>Invoice No:</strong> ${rec.invoiceNo}</p>
        <p><strong>Date:</strong> ${rec.date}</p><hr>
        <p><strong>Customer:</strong> ${rec.customer || '-'}</p>
        <p><strong>Address:</strong> ${rec.address || '-'}</p>
        <p><strong>Services:</strong> ${rec.services}</p>
        <p><strong>Area:</strong> ${rec.area} m²</p>
        <p><strong>Basic:</strong> ₹${rateSum.toFixed(2)}</p>
        <p><strong>GST (18%):</strong> ₹${gstAmt.toFixed(2)}</p>
        <p><strong>Service Tax (2%):</strong> ₹${stAmt.toFixed(2)}</p>
        <p style="font-weight:700;margin-top:10px">Final Total: ₹${finalAmt.toFixed(2)}</p>
        <hr><p>Thank you for choosing Elite Corporation!</p>
        </body></html>
      `;
      const w = window.open();
      w.document.write(invoiceHtml); w.document.close();
      if(rec.mode === 'eChallan') w.print();
    }

    /* ---------- helper: persist saveRecords wrapper ---------- */
    function saveRecords(){
      localStorage.setItem('ec_records', JSON.stringify(RECORDS));
      localStorage.setItem('invoiceCounter', invoiceCounter.toString());
    }
    // fix: initial saveRecords definition conflict resolved by using wrapper above

    /* ---------- small number-to-words (simple) for prints if needed ---------- */
    function numberToWords(num){
      // lightweight helper used elsewhere earlier; keeping simple implementation
      return (Math.round(num) === 0) ? 'Zero Rupees Only' : (Math.round(num) + ' Rupees Only');
    }
  </script>
</body>
</html>
